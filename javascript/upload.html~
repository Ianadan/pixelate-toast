<html>
<head>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<title>Show Image Dimensions Locally</title>
<style type='text/css'>
body {
    font-family: sans-serif;
}
</style>
<script type='text/javascript'>

    // http://www.ajaxblender.com/article-sources/jquery/convert-image-grayscale/index.html
    function grayscaleImage(imgObj)
    {
        var canvas = document.createElement('canvas');
        var canvasContext = canvas.getContext('2d');
        
        var imgW = imgObj.width;
        var imgH = imgObj.height;
        canvas.width = imgW;
        canvas.height = imgH;
        
//        canvasContext.drawImage(imgObj, 0, 0);
        var imgPixels = canvasContext.getImageData(0, 0, imgW, imgH);
        
        for(var y = 0; y < imgPixels.height; y++){
            for(var x = 0; x < imgPixels.width; x++){
                var i = (y * 4) * imgPixels.width + x * 4;
                var avg = (imgPixels.data[i] + imgPixels.data[i + 1] + imgPixels.data[i + 2]) / 3;
                  if (avg > 127) {
                      imgPixels.data[i] = 255;
                      imgPixels.data[i + 1] = 255;
                      imgPixels.data[i + 2] = 255;
                  }
                  else {
                      imgPixels.data[i] = 0;
                      imgPixels.data[i + 1] = 0;
                      imgPixels.data[i + 2] = 0;
                  }

            }
        }
        
//        canvasContext.putImageData(imgPixels, 0, 0, 0, 0, imgPixels.width, imgPixels.height);
        return canvas.toDataURL();
    }
    
    // http://stackoverflow.com/questions/13938686/can-i-load-a-local-file-into-an-html-canvas-element
    function loadImage() {
        var input, file, fr, img;

        if (typeof window.FileReader !== 'function') {
            write("The file API isn't supported on this browser yet.");
            return;
        }

        input = document.getElementById('imgfile');
        if (!input) {
            write("Um, couldn't find the imgfile element.");
        }
        else if (!input.files) {
            write("This browser doesn't seem to support the `files` property of file inputs.");
        }
        else if (!input.files[0]) {
            write("Please select a file before clicking 'Load'");
        }
        else {
            file = input.files[0];
            fr = new FileReader();
            fr.onload = createImage;
            fr.readAsDataURL(file);
        }

        function createImage() {
            img = new Image();
            img.onload = imageLoaded;
            img.src = fr.result;
        }

        function imageLoaded() {
            var canvas = document.getElementById("canvas")
            target_width = 480;
            target_height = 480;
            target_ratio = target_width / target_height;
            real_ratio = img.width / img.height;
            if ( real_ratio > target_ratio ) {
                canvas.width = target_width;
                canvas.height = target_width / real_ratio;
                }
            else {
                canvas.height = target_height;
                canvas.width = target_height * real_ratio;
                }
            console.log(real_ratio, target_ratio, target_height, target_width);
            var ctx = canvas.getContext("2d");
            img.src = grayscaleImage(img);
            ctx.drawImage(img,0,0, canvas.width, canvas.height);
        }

    }

</script>
</head>
<body>
<form action='#' onsubmit="return false;">
    <input type='file' id='imgfile' />
    <input type='button' id='btnLoad' value='Load' onclick='loadImage();' />
</form>
    <canvas id="canvas"></canvas>
</body>

